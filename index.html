<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InmoConecta</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    body { background-color: #f9fafb; }
    .fade-in { animation: fadeIn 0.6s ease-in-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="text-gray-800">
  
  <!-- Encabezado -->
  <header class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto flex items-center justify-between px-6 py-4">
      <div class="flex items-center space-x-3">
        <img src="LOGO_INMOCONECTA.png" alt="InmoConecta" class="h-12">
        <h1 class="text-2xl font-bold text-green-700">InmoConecta</h1>
      </div>
      <input id="search" type="text" placeholder="Buscar por referencia o palabra clave..." 
        class="border border-gray-300 rounded-lg px-4 py-2 w-80 focus:ring focus:ring-green-200 outline-none">
    </div>
  </header>

  <!-- Listado de Propiedades -->
  <main class="container mx-auto px-6 py-10">
    <h2 class="text-3xl font-semibold text-gray-800 mb-8 text-center">Propiedades disponibles</h2>
    <div id="listado" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
  </main>

  <!-- Pie de página -->
  <footer class="bg-gray-800 text-white py-6 text-center">
    <p>&copy; 2025 InmoConecta - Conectando Hogares, Uniendo Futuros</p>
  </footer>

  <script>
    const sheetURL = "TU_URL_AQUI"; // <-- pega aquí tu URL publicada en CSV

    async function cargarDatos() {
      const response = await fetch(sheetURL);
      const csvData = await response.text();
      const parsed = Papa.parse(csvData, { header: true });
      mostrarPropiedades(parsed.data);
    }

    function mostrarPropiedades(datos) {
      const contenedor = document.getElementById("listado");
      contenedor.innerHTML = "";

      datos.forEach(item => {
        if (!item.ref) return; // ignora filas vacías

        // Procesar imágenes (una o varias)
        const imagenes = item.fotos ? item.fotos.split(",").map(url => url.trim()) : [];
        const primeraImagen = imagenes[0] || "https://via.placeholder.com/400x300?text=Sin+Imagen";

        // Crear tarjeta
        const card = document.createElement("div");
        card.className = "bg-white shadow-lg rounded-2xl overflow-hidden fade-in hover:shadow-2xl transition";
        card.innerHTML = `
          <div class="relative">
            <img src="${primeraImagen}" alt="${item.titulo}" class="w-full h-56 object-cover">
            ${item.estado?.toLowerCase() === "cerrado" ? `<span class="absolute top-2 right-2 bg-red-600 text-white px-2 py-1 rounded">Cerrado</span>` : ""}
          </div>
          <div class="p-5">
            <h3 class="text-xl font-bold mb-2 text-green-700">${item.titulo || "Propiedad"}</h3>
            <p class="text-gray-600 text-sm mb-2">${item.tipo || ""} - Ref: ${item.ref || ""}</p>
            <p class="text-gray-800 font-semibold mb-2">${item.precio || ""}</p>
            <p class="text-gray-600 text-sm mb-1">${item.direccion || ""}</p>
            <p class="text-gray-600 text-sm mb-4">${item.descripcion || ""}</p>
            <div class="flex justify-between text-gray-500 text-sm">
              <span>${item.metros || ""} m²</span>
              <span>${item.habitaciones || ""} hab.</span>
            </div>
          </div>
        `;
        contenedor.appendChild(card);
      });
    }

    // Buscador dinámico
    document.getElementById("search").addEventListener("input", e => {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll("#listado > div").forEach(card => {
        card.style.display = card.textContent.toLowerCase().includes(term) ? "" : "none";
      });
    });

    cargarDatos();
  </script>
</body>
</html>
